<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game Watch - Game Library</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
    <div class="top-bar">
        <h1 class="title">Game Watch</h1>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="trending.html">Trending</a>
        </div>
        <div class="search-container">
            <input type="text" id="search" placeholder="Search for a game..." autocomplete="off" />
            <div class="suggestions" id="suggestions"></div>
        </div>
    </div>

    <div class="game-library">
        <h2>Search Results</h2>
        <p>Total Results: <span id="total-results">0</span></p>
        <div class="result-grid" id="results-container">
            </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Game Watch</p>
    </div>

    <script>
        const games = [
            { title: "Minecraft" },
            { title: "Fortnite" },
            { title: "Roblox" },
            { title: "Counter-Strike 2"},
            { title: "Apex Legends" },
            { title: "League of Legends" },
            { title: "Call of Duty: Warzone" },
            { title: "Valorant" },
            { title: "Dota 2"},
            { title: "PUBG: Battlegrounds"}
        ];

        const searchInput = document.getElementById("search");
        const suggestionsContainer = document.getElementById("suggestions");
        let highlightedIndex = -1;
        const resultsContainer = document.getElementById("results-container");
        const totalResultsElement = document.getElementById("total-results");

        // Get the query from the URL
        const urlParams = new URLSearchParams(window.location.search);
        const query = urlParams.get('q');

        if (query) {
            displaySearchResults(query);
        } else {
            // Handle the case where there is no search query.
            resultsContainer.innerHTML = "<p>Please enter a search query on the home page.</p>";
            totalResultsElement.textContent = 0;
        }

        searchInput.addEventListener("input", () => {
            const query = searchInput.value.toLowerCase();
            suggestionsContainer.innerHTML = "";
            highlightedIndex = -1;

            if (query.length === 0) {
                suggestionsContainer.style.display = "none";
                return;
            }

            const matches = games.filter(game => game.title.toLowerCase().includes(query));

            if (matches.length === 0) {
                suggestionsContainer.style.display = "none";
                return;
            }

            matches.forEach((game, index) => {
                const div = document.createElement("div");
                div.textContent = game.title;
                div.addEventListener("click", () => {
                    searchInput.value = game.title;
                    suggestionsContainer.innerHTML = "";
                    suggestionsContainer.style.display = "none";
                     window.location.href = `search.html?q=${encodeURIComponent(game.title)}`;
                });
                suggestionsContainer.appendChild(div);
            });
            suggestionsContainer.style.display = "block";
        });

        searchInput.addEventListener("keydown", (e) => {
            const suggestionDivs = suggestionsContainer.getElementsByTagName("div");

            if (e.key === "ArrowDown") {
                e.preventDefault();

                if (highlightedIndex < suggestionDivs.length - 1) {
                    highlightedIndex++;
                } else {
                    highlightedIndex = 0;
                }
                updateHighlight();
            } else if (e.key === "ArrowUp") {
                e.preventDefault();

                if (highlightedIndex > 0) {
                    highlightedIndex--;
                } else {
                    highlightedIndex = suggestionDivs.length - 1;
                }
                updateHighlight();
            } else if (e.key === "Enter") {
                e.preventDefault();

                if (highlightedIndex >= 0 && highlightedIndex < suggestionDivs.length) {
                    const selectedGameTitle = suggestionDivs[highlightedIndex].textContent;
                    searchInput.value = selectedGameTitle;
                    suggestionsContainer.innerHTML = "";
                    suggestionsContainer.style.display = "none";
                     window.location.href = `search.html?q=${encodeURIComponent(selectedGameTitle)}`;
                } else if (searchInput.value.trim() !== "") {
                     window.location.href = `search.html?q=${encodeURIComponent(searchInput.value)}`;
                }
            } else if (e.key === "Escape") {
                suggestionsContainer.innerHTML = "";
                suggestionsContainer.style.display = "none";
                highlightedIndex = -1;
            }
        });

        function updateHighlight() {
            const suggestionDivs = suggestionsContainer.getElementsByTagName("div");
            for (let i = 0; i < suggestionDivs.length; i++) {
                if (i === highlightedIndex) {
                    suggestionDivs[i].classList.add("highlighted");
                } else {
                    suggestionDivs[i].classList.remove("highlighted");
                }
            }
        }

        document.addEventListener("click", (e) => {
            if (!suggestionsContainer.contains(e.target) && e.target !== searchInput) {
                suggestionsContainer.style.display = "none";
                highlightedIndex = -1;
            }
        });

        function displaySearchResults(query) {
            const results = games.filter(game => game.title.toLowerCase().includes(query.toLowerCase()));
            resultsContainer.innerHTML = "";
            totalResultsElement.textContent = results.length;

            results.forEach(game => {
                const gameCard = document.createElement("div");
                gameCard.className = "game-card basic";

                //set appropriate classname
                if (game.title === "Minecraft") {
                    gameCard.className = "game-card gold-card";
                } else if (game.title === "Fortnite") {
                    gameCard.className = "game-card silver-card";
                } else if (game.title === "Roblox") {
                    gameCard.className = "game-card bronze-card";
                }


                gameCard.innerHTML = `
                    <div class="game-image"></div>
                    <div class="game-info">
                        <h2 class="game-title">${game.title}</h2>
                        <p class="rank"><span>#${games.indexOf(game) + 1}</span></p>
                        <p class="monthly-players">
                        ${getMonthlyPlayers(game.title)}
                        </p>
                    </div>
                `;
                resultsContainer.appendChild(gameCard);
            });
        }

        function getMonthlyPlayers(title) {
            switch (title) {
                case "Minecraft":
                    return "228M+ Monthly Players";
                case "Fortnite":
                    return "223M+ Monthly Players";
                case "Roblox":
                    return "205M+ Monthly Players";
                case "Counter-Strike 2":
                    return "65M+ Monthly Players";
                case "Apex Legends":
                    return "64M+ Monthly Players";
                case "League of Legends":
                    return "64M+ Monthly Players";
                case "Call of Duty: Warzone":
                    return "58M+ Monthly Players";
                case "Valorant":
                    return "55M+ Monthly Players";
                case "Dota 2":
                    return "50M+ Monthly Players";
                case "PUBG: Battlegrounds":
                    return "45M+ Monthly Players";
                default:
                    return "N/A";
            }
        }
    </script>
</body>
</html>